---
title: "R Notebook"
output: html_notebook
---


```{r}
allEvents %>% group_by(groupedAttacker, year) %>% summarize(num = n()) %>% arrange(-num) %>% filter(groupedAttacker %in% c("FARC", "ELN", "AUC", "Government", "Other Paramilitary"))

allEvents <- allEvents %>% mutate(
  eventType = 
    case_when( 
      str_detect(Murder, "es") ~ "Murder",  
      str_detect(AttackOrInjury, "es") ~ "Attack",
      str_detect(ArmedConflict, "es") ~ "Armed Conflict",
      str_detect(Kidnapping, "es") ~ "Kidnapping",  
      str_detect(HarassmentOrThreats, "es") ~ "Threats or Harrassment",
      TRUE ~ "Other"
      
    )
)

allEvents %>% group_by(year) %>% summarize(numAttacks=n()) %>% filter(year >= 1993) %>%   ggplot(aes(x=year, y=numAttacks)) + geom_line() + geom_point() +
  theme_light()
# Download a Google map of Colombia
register_google(key="yourApiKeyHere")
register_stadiamaps("otherApiKeyHere")

colombiaCoords <- c(left = -80, bottom = -5, right = -64, top = 14)
get_stadiamap(colombiaCoords, zoom = 6, maptype = "stamen_toner_lite") -> colombia_map
ggmap(colombia_map)

for(i in 1993:2022){
  library(ggplot2)
  library(ggmap)
  library(dplyr)
  
  tempViolence <- allEvents %>% ungroup() %>% 
    mutate(NumVictimsInt = parse_integer(NumVictims),
           NumDeadInt = parse_integer(NumDead),
           num_affected = pmax(NumVictimsInt, NumDeadInt, na.rm = TRUE),
           num_affected = if_else(is.na(num_affected), 1, num_affected),
           num_affected = if_else(num_affected < 1, 1, num_affected)) %>% 
    filter(year == i, num_affected != "-1", num_affected < 10000,
           groupedAttacker %in% c("FARC", "ELN", "Government")) %>% 
    mutate(lognum_affected = log(num_affected, base = 10)) %>% 
    select(gMapLat, gMapLon, groupedAttacker, lognum_affected, eventType) %>% 
    filter(!is.na(gMapLat), !is.na(gMapLon))
  
  ggmap(colombia_map) +
    geom_point(data = tempViolence,
               aes(x = gMapLon, y = gMapLat, color = groupedAttacker, shape = eventType,  
                   size = lognum_affected), alpha = 0.6) +
    labs(title = paste("All Violence Events: ", i),
         color = "Grouped Attacker",
         shape = "Event Type",
         size = "Number Affected",
         x = "Longitude", 
         y = "Latitude") + 
    scale_size_continuous(breaks = 0:5,
                          labels = c("1", "10", "100", "1,000", "10,000", "100,000")) + 
    theme_minimal()
  # Ensure the plot is saved as a square image
  ggsave(paste0("C:\\Users\\DavidAnderson\\Documents\\ColumbiaText\\finalFigs\\EventMap_", i, ".jpg"), 
         width = 7, height = 7)
}

```

